<form id="{{ form.vars.id }}">

    {{ form_row(form.widget_id)}}

    {#{{ form_row(form.widget_choices) }}#}

    {# This is temporary implementation of widget_choices #}
    {{ form_label(form.widget_choices) }}
    {% set dataProtoType %}
        {% filter escape %}
            {% include 'ChromediaWidgetFormBuilderBundle:Examples:_choice.html.twig' 
                with {'widget_choice': form.widget_choices.vars.prototype } 
            %}
        {% endfilter %}
    {% endset %}

    <div class="collection-container" data-prototype="{{ dataProtoType }}">
        {% for widget_choice in form.widget_choices %}
            {% include 'ChromediaWidgetFormBuilderBundle:Examples:_choice.html.twig' with {
                'widget_choice' : widget_choice
            }%}
        {% endfor %}
    </div>
    <a href="#" class="button-grey add-to-collection">Add</a>

    {# End of widget_choices #}

    {{form_row(form.widget_attribute)}}

</form>

<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="{{ asset('bundles/chromediawidgetformbuilder/js/widgetFormBuilder.js') }}"></script>
<script type="text/javascript">
(function(){
    $(function(){
        var widgetBuilder = new WidgetFormBuilder({
            form: $('#{{ form.vars.id }}')
        });

        widgetBuilder.initForm();
    });

    // temporary for now, does not know yet where to put this or if im in the right direction,,:/

    /**
     * Adds form row collection
     */
    var addFormRowInCollection = function($_collectionHolder) {
        var prototype = $_collectionHolder.data('prototype');
        var index = $_collectionHolder.data('index');
        var newForm = prototype.replace(/__name__/g, index);

        $_collectionHolder.data('index', index + 1);
        $_collectionHolder.append($(newForm));
    }

    $('.add-to-collection').on('click', function(e) {
        e.preventDefault();
    
        var collectionHolder = $('.collection-container');
        collectionHolder.data('index', collectionHolder.find('.collection-field-container').length);

        addFormRowInCollection(collectionHolder);     
    });

    $('.collection-container').on('click', '.collection-delete-item', function(e) {
        e.preventDefault();
        $(this).closest('.collection-field-container').hide().html('');
    });
    // end of widget_choices

})(jQuery);
</script>